<!DOCTYPE html>
<html lang="zh-CN" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>员工信息</title>
    <link href="bootstrap.min.css" th:href="@{/static/bootstrap.min.css}" rel="stylesheet">
    <script th:src="@{/static/jquery-3.6.0.min.js}"></script>
    <script type="text/javascript">

        $(document).ready(function () {
            // Add person
            $('#addButton').click(function () {
                var name = $('#name').val();
                var wid = $('#wid').val();
                var gender = $('#gender').find('option:selected').text();
                var username = $('#username').val();
                var password = $('#password').val();

                if (!name.trim() || !wid.trim() || !username.trim() || !password.trim() || $('#gender').find('option:selected').attr("id") === "defaultSelectedGender") {
                    alert("请输入正确的值。")
                } else {
                    console.log("Input validated.");
                    var isConfirm = confirm("请确认新增人员的信息：\n\n姓名：" + name + "\n工号：" + wid + "\n性别：" + gender + "\n\n用户名：" + username + "\n密码：" + password);
                    if (isConfirm) {
                        $.ajax({
                            url: '/api/createNewEmp',
                            method: 'post',
                            data: {name: name, wid: wid, gender: gender, username: username, password: password},
                            success: function (data) {
                                if (data === "success") {
                                    alert("添加成功。");
                                    window.location.reload();
                                    showPerson();
                                }
                                else if (data === "duplicated") {
                                    alert("此工号已存在，请重试。");
                                } else {
                                    alert("出现了一些问题，请重试。");
                                }
                            }
                        });
                    }
                }

            })

            // Update person
            $('#updateButton').click(function () {
                var id = $('#update_worker_id').val();
                console.log("Updated worker id: " + id);

                var updatedName = $('#update_name').val();
                var updatedGender = $('#update_gender').find('option:selected').text();
                var isConfirmUpdate = confirm("更新信息\n\n姓名：" + updatedName + "\n性别：" + updatedGender + "\n\n确定要更新吗？");
                if (isConfirmUpdate) {
                    $.ajax({
                        url: '/api/updateWorker/' + id,
                        method: 'put',
                        data: {name: updatedName, gender: updatedGender},
                        success: function (data) {
                            if (data === "success") {
                                alert("信息已更新。");
                                window.location.reload();
                            } else if (data === "failed") {
                                alert("出现了一些问题，请重试。");
                            }
                        },
                        error: function (data) {
                            alert("出现了一些问题，请重试。");
                        }
                    });

                    //隐藏添加人员界面
                    var div3 = document.getElementById("div3");
                    div3.style = "display: none;";
                }


            })
        })

        /**显示人员信息**/
        function showPerson() {
            //显示表格
            var div1 = document.getElementById("div1");
            div1.style = "display: block;";
        }

        /**显示新增人员信息**/
        function showAddPerson() {
            //隐藏更新人员界面
            var div3 = document.getElementById("div3");
            div3.style = "display: none;";
            var div2 = document.getElementById("div2");
            div2.style = "margin: 2.25rem;";
        }


        /**取消按钮，隐藏表单**/
        function cancel() {
            //隐藏新增人员信息界面
            var div2 = document.getElementById("div2");
            div2.style = "display: none;";
            //隐藏更新人员信息界面
            var div3 = document.getElementById("div3");
            div3.style = "display: none;";
        }

        /**根据id删除人员信息**/
        function deletePerson(id) {
            console.log("ID: " + id);
            var isConfirm = window.confirm("确定要解雇吗？");
            if (isConfirm) {
                $.ajax({
                    url: '/api/resignWorker',
                    method: 'put',
                    data: {id: id},
                    success: function (data) {
                        if (data === "success") {
                            alert("人员已解雇。");
                            window.location.reload();
                        } else {
                            alert("出现了一些问题，请重试。");
                        }
                    },
                    error: function (data) {
                        alert("出现了一些问题，请重试。");
                    }
                })
            }
        }

        /**根据id修改人员信息**/
        function showUpdatePerson(id) {
            console.log("ID: " + id);

            // get worker while show update
            $.ajax({
                url: '/api/getWorker/' + id,
                method: 'get',
                success: function (worker) {
                    $('#update_worker_id').val(id);
                    $('#emp_id').val(worker.wid);
                    $('#emp_id').prop('disabled', true);
                    $('#update_name').val(worker.name);
                    if (worker.gender === "男") {
                        $('#update_gender').val("M");
                    } else if (worker.gender === "女") {
                        $('#update_gender').val("F");
                    } else {
                        console.log("Gender setter failed.")
                    }
                }
            })

            //隐藏添加人员界面
            var div2 = document.getElementById("div2");
            div2.style = "display: none;";
            //显示更新人员界面
            var div3 = document.getElementById("div3");
            div3.style = "margin: 2.25rem";
        }
    </script>
</head>
<body>
<div id="" style="margin: 1.25rem;">
    <button type="button" class="btn btn-info" onclick="showPerson()"><span class="glyphicon glyphicon-qrcode"></span>
        显示人员信息
    </button>
    <button type="button" class="btn btn-info" onclick="showAddPerson()"><span
            class="glyphicon glyphicon-sound-stereo"></span> 新增人员信息
    </button>
</div>

<!-- 表格信息 -->
<div id="div1" style="margin: 1.25rem; display: none">
    <center><h1 th:if="${#lists.isEmpty(workerList)}">还没有员工，请添加后再试。</h1></center>
    <table border="1" class="table table-hover" id="table1" style="margin: 2.25rem"
           cellspacing="2" cellpadding="2"
           th:if="${not #lists.isEmpty(workerList)}">
        <tr>
            <th>序号</th>
            <th>工号</th>
            <th>姓名</th>
            <th>性别</th>
            <th>状态</th>
            <th>操作</th>
        </tr>
        <tr th:each="worker: ${workerList}">
            <td th:text="${worker.id}"></td>
            <td th:text="${worker.wid}"></td>
            <td th:text="${worker.name}"></td>
            <td th:text="${worker.gender}"></td>
            <td th:if="${worker.status == 1}">在职</td>
            <td th:if="${worker.status == 2}">离职</td>
            <td>
                <button th:if="${worker.status == 1}" type='button' class='btn btn-success'
                        th:attr="onclick=|showUpdatePerson('${worker.getId()}')|">更新
                </button>
                &nbsp;&nbsp;
                <button th:if="${worker.status == 1}" type='button' class='btn btn-danger'
                        th:attr="onclick=|deletePerson('${worker.getId()}')|">解雇
                </button>
            </td>
        </tr>
    </table>
</div>

<!-- 新增人员信息 -->
<div id="div2" style="display: none;margin: 1.25rem;">
    <fieldset id="field2">
        <legend>新增人员信息</legend>
        <table class="table table-hover">
            <tr>
                <td>姓名:</td>
                <td><input type="text" class="form-control" name="name" id="name"/></td>
            </tr>
            <tr>
                <td>工号：</td>
                <td><input type="text" class="form-control" name="wid" id="wid"/></td>
            </tr>
            <tr>
                <td>性别：</td>
                <td>
                    <label for="gender"><select id="gender" name="sex" class="form-control" required="required">
                        <option id="defaultSelectedGender" selected="selected" disabled>-- 请选择 --</option>
                        <option value="M">男</option>
                        <option value="F">女</option>
                    </select></label>
                </td>
            </tr>
            <tr>
                <td>用户名:</td>
                <td><input type="text" class="form-control" name="username" id="username" autocomplete="false"/></td>
            </tr>
            <tr>
                <td>密码：</td>
                <td><input type="password" class="form-control" name="password" id="password" autocomplete="false"/>
                </td>
            </tr>
            <tr>
                <td>
                    <button type="button" class="btn btn-primary" id="addButton">确定</button>
                    <button type="button" class="btn btn-warning" onclick="cancel()">取消</button>
                </td>
            </tr>
        </table>
    </fieldset>
</div>

<!-- 更新人员信息 -->
<div id="div3" style="display: none;margin: 1.25rem;" name="div3">
    <fieldset id="field3">
        <legend>更新人员信息</legend>
        <table class="table table-hover">
            <tr>
                <td type="text" id="update_worker_id" hidden></td>
                <td>工号：</td>
                <td><input type="text" class="form-control" name="emp_id" id="emp_id"/></td>
            </tr>
            <tr>
                <td>姓名：</td>
                <td><input type="text" class="form-control" name="name" id="update_name"/></td>
            </tr>
            <tr>
                <td>性别：</td>
                <td>
                    <label for="gender"><select id="update_gender" name="sex" class="form-control" required="required">
                        <option value="M">男</option>
                        <option value="F">女</option>
                    </select></label>
                </td>
            </tr>
            <tr>
                <td>
                    <button type="button" class="btn btn-success" id="updateButton" style="float:left;">确定</button>
                    &nbsp;
                    <button type="button" class="btn btn-warning" onclick="cancel()">取消</button>
                </td>
            </tr>
        </table>
    </fieldset>
</div>
</body>
</html>